# Dockerfile.dev - Backend (développement local)
FROM node:20-alpine

# Installer les dépendances système nécessaires pour Prisma
RUN apk add --no-cache openssl

WORKDIR /app
ENV NODE_ENV=development

# Copier uniquement les fichiers liés aux dépendances pour exploiter le cache
COPY package*.json ./
COPY prisma ./prisma/

# Installer toutes les dépendances (y compris dev) puis générer Prisma
RUN npm ci \
 && npx prisma generate \
 && chown -R node:node /app

# Copier le reste du code avec les bons droits
COPY --chown=node:node . .

# Passer sur l'utilisateur non-root pour le développement
USER node

# Exposer le port de NestJS
EXPOSE 3001

# Lancer l'application NestJS en mode développement (watch)
CMD ["npm", "run", "dev"]
